---
layout: post
title: 回顾
tag: 生活
keywords: review
---

## 在这家公司做了哪些项目里

在新公司主要做了hrosaas，hrsaas，微信第三方平台（用来生成客户小程序），以及公司的一些招聘，缴纳社保的小程序。也做了公司产品小程序配套的公众号页面。

## 这些项目里有遇到什么困难

### 在小程序实现全局状态管理库

在招聘小程序中写聊天页面的时候，需要使用类似vuex的全局状态管理库，然后自己封装了一个，主要的思路是先封装Page函数和Component函数，传入store和options，将需要用到store的数据设置在options.use里，然后遍历递归这个use这个数组，生成这个这个page需要依赖的keymap，以及在第一个使用封装Page页面的onload中使用Object.defineProperty开始监听store里数据的变化，并使用this.setData赋值初始值。当store里的数据变化的时候，会依次遍历所有的路由实例，如果当前页面的keymap有依赖这个数据的话，则执行setdata函数。

这里针对数组的监听类似vue2中的实现，只对常用的几个数组函数做了重写。针对store还做了page构造器的computed和watch。

### 做聊天微信小程序

使用的是腾讯的IM通信服务，然后自己实现聊天需要的功能，群组，成员设置（禁言，踢出），群公告，个人信息，聊天信息（文本，语音，表情，图片），自定义消息（诸如红包）。然后在写聊天页面中，因为需要上移滚动弹出历史消息，那么理想的实现方式就是使用column-reserve，这个可以比较完美的完成这个需求。但是每个聊天记录的前几条会在最下面呈现，而这个又与想要的不符合，所以这里还去获取了聊天页面的实际高度，并且在聊天数据较少的时候去计算聊天内容的高度，如果没有超过实际高度，则使用flex-end，否则使用flex-start。

然后就是scroll-view的滚动到顶部后触发到事件，在使用column-reserve后，ios和安卓机在微信里的表现形式不一致，安卓能够准确的监听到这个事件，但是ios无法准确的监听到，所以ios的这个事件需要自己实现，这里需要做节流处理，因为不需要那么高精度的滑动距离操控。[bug链接](https://developers.weixin.qq.com/community/develop/doc/00066652780e70e4327bc1c585b400)。

实现了自定义海报。

在九月份上线了，hr和求职者单聊的聊天模式，体验吊打boss招聘，拼多多等各种同类单聊小程序。

### 做第三方平台

主要还是步骤比较繁琐，需要手动实现微信公众平台的功能，但是做完感觉难度也不大。

现在的第三方平台小程序主要是做招聘相关的，里面实现了线上换肤，海报等等

### 做了企业微信的插件，智联招聘的自动爬取插件

企业微信的插件的功能是，企业微信用户通过企业微信给微信客户发送h5链接，然后微信用户打开h5链接，可以直接填写个人信息，然后企业微信用户可以直接通过插件直接预览微信用户填的信息。

智联招聘的自动爬取插件主要是先通过chrome插件获取当前用户(大概需要4-5个左右)的token一些鉴权信息，rt，at啥的，然后在自己搭建的node后台服务器直接建立请求爬取接口(当然这里需要有一些避免被当作机器人的逻辑操作)。

### hrss-admin和hross

在做这几个项目的时候，因为前期为了项目开发进度快，hross选取了layui，hrss采用了guns-admin，但是这两个框架在使用的时候都有一定的缺陷。layui老旧，api不友好，不好维护，耦合性强，好处是兼容老式浏览器，开发进度快。guns-admin系统内容太多，启动慢，对我们来说无效组件太多，而且采用的是vue2，而现在vue3性能对比高了很多，而且我们又没有需要兼容ie11及一下的浏览器，所以最后hrss-admin采用guns-admin的后台，然后自己开发了一套适配该后台的vue3基础框架，保留了原有系统的权限管理，放弃了vue2和antd-design-vue，使用情况对比guns-admin改良了很多。而且也没有首屏渲染慢的问题。

guns-admin使用体验不好有一部分原因是采用antd-pro原始框架配上guns自有的权限配置，使得在登陆后的操作过多，现在鉴权的判断，动态渲染路由，以及系统应用的切换。我后面将大系统拆分成一个个小系统，在同一个应用管理后台的大体系下，每个应用对应一个项目，不在需要切换系统应用，不再需要获取所有应用的路由，以及简化了权限的判断。


### 更新wxml-to-canvas库

因为部分安卓手机在高dpr的情况下，将canvas渲染成图片导出的时候像素过大，导致文件过大，故设置安卓部分手机dpr为2。

实现多行自动添加省略号的功能。

在render前，await画布的初始化。



## 代码格式

统一使用prettier，saas，小程序使用gulp自动编译sccs成wxss。

## 全面拥抱TS

新的项目基本可以用的都用上了TS。


## 佛系开源

wxml-to-canvas-enhance。

vant，naive-ui，weex-ui，ant-design-pro，ecomfe/zrender。 pr。


